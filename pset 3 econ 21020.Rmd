---
title: "PSET 3 ECON 21020"
author: "Matthew Zhao"
output: pdf_document
---

Link to the **[GitHub Repository](https://github.com/mattzhao-R/econ-21020)**

# Problem 1

## a)

False. The $\text{X}_{\text{i}}\text{'s}$ are not iid. Therefore, suppose all the $\text{X}_{\text{i}}\text{'s}$ are equal to $\text{X}_{\text{1}}$. If this is the case, the expression $\sqrt{n}(\frac{1}{n}\sum_{i=1}^n X_i -E[X]) = \sqrt{n}(X_1 -E[X])$ which does not converge in distribution to $N(0,Var(X))$

## b) 

False. Suppose U is independent of W but U is not independent of X and U takes values 1 and -1 w.p. 0.5. As a result, $E(U|W) = E(U) = 0$ but $E(U|W,X) = E(U|X)$ which does not necessarily equal zero. 

## c)

True. <br/>
$\beta = \displaystyle \frac{Cov(X,Y)}{Var(X)}$<br/>
$Cov(X,Y) = E(XY) - E(X)E(Y)$<br/>
$E(Y) = E(E(Y|X)) = E(X^2) = \frac{1}{3}$<br/>
$E(X) = \frac{1}{2}$<br/>
$E(XY) = E(E(XY|X)) = E(XE(Y|X)) = E(X^3) = \frac{1}{4}$<br/>
$\Rightarrow Cov(X,Y) = \frac{1}{4} - (\frac{1}{2})(\frac{1}{3}) =\frac{1}{12}$<br/>
$Var(X) = E(X^2) - E(X)^2 = \frac{1}{3} - (\frac{1}{4})^2 = \frac{1}{12}$<br/>
$\Rightarrow \beta = 1$

# Problem 2

## a)

(1) The quality of their upbringing (2) Their individual level of risk-averseness

## b)

The RA assumption here is that W independent U i.e. the event that the offender's sentence included confinement or not is independent of the unobserved determinants of having a repeat offense. It does not seem plausible here. An example of a $u\in U$ that is not independent of W is wealth. If a person is poor, they are more likely to steal 

## c)

g(1,U) is the event that the offender committed another crime or not if their sentence included confinement. g(0,U) is the event that they committed another crime or not if their sentence did not. 

## d) 

$ATE = E(g(1,U)-g(0,U))$. ATE is the expected effect of sentencing with confinement on the event that an offender committs another crime. 

## e)

Yes. Since the judge would want to prevent repeat offenses, they would use the ATE to determine if they should sentence with or without confinement depending on what the sign of ATE is (positive means they should not since confinement is associated with an increase in repeat offenses, negative means they should)


## f)

$ATT = E(g(1,U) - g(0,U)|W=1)$


$ATE = E(g(1,U) - g(0,U)) = E(g(1,U) - g(0,U)|W=1)P(W=1) + E(g(1,U) - g(0,U)|W=0)P(W=0) = -0.2$


$E(g(1,U) - g(0,U)|W=1) = \displaystyle \frac{-0.2 -0.4E(g(1,U) - g(0,U)|W=0)}{0.6}$


Since ATU can be any number, ATT$\in \mathbb{R}$

## g)

ATE = 0.6ATT + 0.4ATU $\ge$ 0.6ATT + 0.4ATT = ATT $\Rightarrow$ ATE$\ge$ATT $\Rightarrow -0.2 \ge$ ATT 


ATT $\in (-\infty,-0.2)$

## h)

Yes if RA is plausible. Since ATT is bounded above by a negative value, this means that the expected effect of sentencing with confinement for those with sentences including confinement on recidivism is negative. This means that the effect of sentencing with confinement on those with sentencing with confinement is associated with a lower likelihood of repeat offense. If RA is not plausible, we can only say that changing sentences of juvenile offenders who are about to be sentenced to confinement will be associated with an increase in expected recidivism.

# Problem 3

## a) 

intelligence

## b) 

g(1,U), g(2,U), g(3,U)...g(w,U) for $w\in\mathbb{N}$<br/>
The potential outcome is the student's score on the ECON 21020 final if they have w students in their class. We cannot define outcomes for non-integer valued w because w represents the number of students in a class and there cannot be a fraction of a student in a class. 

## c)

$\beta$ is the approximate change in the student's score on the ECON 21020 final associated with an increase in class size of 1 student. 

## d)

$\hat{\beta}_n \pm z_{1-\frac{\alpha}{2}} \cdot se(\hat{\beta}_n)$


$-0.7 \pm 1.96 \cdot 0.2$


$(-1.092,-0.308)$

## e) 

$T_n = \displaystyle |\frac{\hat{\beta}_n - \beta_0}{se(\hat{\beta}_n)}| = |\frac{-0.7}{0.2}| = 3.5$


$p = 2(1-\phi(T_n)) = 4.65 \times 10^{-4}$


Since p<0.05, we reject the null hypothesis that $\beta=0$. In words, we can conclude that the approximate change in the student's score on the ECON 21020 final associated iwht a change in the class size of 1 student is not zero. 

## f)

It is not accurate since here we are simply using regresssion and our result only shows association while the headline makes it seem like smaller class sizes cause students to get higher scores. 

## g)

We can use the RA assumption that W is independent of U. It does not seem plausible because students use course evaluations to choose classes based on the quality of instruction. As a result, class sizes $w$ are most likely related to quality of instruction, and the latter is related to the student's score on the final Y and so U is not independent of W. 


# Problem 4

Showing (4):
$$\displaystyle \text{arg}\min_{\alpha,\beta \in \mathbb{R}} E((E(Y|X)-(\alpha + X\beta))^2)$$


$$E(E(Y|X)^2-2E(Y|X)(\alpha+X\beta)+(\alpha+X\beta)^2)=$$


$$=E(E(Y|X)^2-2\alpha E(Y|X)-2X\beta E(Y|X)+\alpha^2+2\alpha X\beta+X^2\beta^2)$$


$$=E(E(Y|X)^2)-2\alpha E(E(Y|X))-2\beta E(XE(Y|X))+\alpha^2+2\alpha\beta E(X)+\beta^2 E(X^2)$$


$$=E(E(Y|X)^2)-2\alpha E(Y)-2\beta E(XY)+\alpha^2+2\alpha\beta E(X)+\beta^2E(X^2)$$


FOCs:
[$\beta$]$-2E(YX)+2\alpha E(X)+2\beta E(X^2)=0$


$-E(YX)+\alpha E(X)+\beta E(X^2)=0$


[$\alpha$]$-2E(Y)+2\alpha+2\beta E(X)=0$


$-E(Y)+\alpha+\beta E(X)=0$


$\alpha=E(Y)-E(X)\beta$


$\Rightarrow-E(YX)+E(Y)E(X)-E(X)^2\beta+\beta E(X^2)=0$


$\beta(E(X^2)-E(X)^2)=E(YX)-E(Y)E(X)=\beta Var(X)=Cov(X,Y)\Rightarrow\beta=\displaystyle\frac{Cov(X,Y)}{Var(X)}$


Showing (5):
$$\displaystyle \text{arg}\min_{\alpha,\beta \in \mathbb{R}} E((Y-(\alpha + X\beta))^2)$$
$$E(Y^2-2Y(\alpha+X\beta)+(\alpha + X\beta)^2) = $$
$$=E(Y^2-2\alpha Y-2X\beta Y + \alpha^2 + 2\alpha X\beta + X^2 \beta^2 ) $$
$$=E(Y^2) - 2\alpha E(Y)  -2\beta E(XY) + \alpha^2 + 2\alpha\beta E(X) +\beta^2 E(X^2)$$
$$=E(Y^2) - 2\alpha E(Y)  -2\beta E(XY) + \alpha^2 + 2\alpha\beta E(X) +\beta^2 E(X^2)$$
FOCs:


[$\beta$] $-2E(YX) + 2\alpha E(X) + 2\beta E(X^2) = 0$


$-E(YX) + \alpha E(X) + \beta E(X^2) = 0$


[$\alpha$] $-2E(Y)+2\alpha + 2\beta E(X) =0$


$-E(Y)+\alpha + \beta E(X) =0$


$\alpha = E(Y) - E(X)\beta$



$\Rightarrow -E(YX) + E(Y)E(X)- E(X)^2 \beta + \beta E(X^2) = 0$


$\beta (E(X^2)-E(X)^2) = E(YX) - E(Y)E(X) = \beta Var(X) = Cov(X,Y) \Rightarrow \beta = \displaystyle \frac{Cov(X,Y)}{Var(X)}$


# Problem 5

## a) 

$\displaystyle w(t)=\frac{1}{Var(X)}\int_t^\infty (X-E[X])f(x)dx$


$\displaystyle\frac{\partial}{\partial t}w(t) = \frac{1}{Var(X)}[(X-E[X])f(x)]^{\infty}_{t} =0$


$\displaystyle\frac{\partial}{\partial t}w(t) = (\lim_{x\to\infty}(X-E[X])f(x)) -(t-E[X])f(t) =0 \Rightarrow (\lim_{x\to\infty}(X-E[X])f(x)) = (t-E[X])f(t)$


$\displaystyle \lim_{x\to\infty}(X-E[X])f(x) =0 \text{  since for } x>1, f_{X}(x)=0 \text{ since } X\sim U(-1,1)\Rightarrow (t-E[X])f(t) = 0 \Rightarrow t-E[X]=0 \Rightarrow t=E(X)$



## b)

$E(X|X\ge t) = E(X)$ where X$\sim$U(t,1)


$E(X|X\ge t) = \frac{1+t}{2}$


$E(X|X< t) = \frac{-1+t}{2}$


$P(X\ge t) = 1-P(X< t) = 1- \frac{1+t}{2} = \frac{1-t}{2}$


$Var(X) = E(X^2)-E(X)^2$, $E(X)=0$, $E(X^2) = \frac{1}{3} \Rightarrow Var(X) = \frac{1}{3}$

## c)

$w(t) = \displaystyle \frac{(E(X|X\ge t)-E(X|X< t))P(X\ge t)P(X\le t)}{Var(X)} 1\{t\in [-1,1]\}$


$\displaystyle = \frac{(\frac{1+t}{2}-\frac{-1+t}{2})(\frac{1-t}{2})(\frac{1+t}{2})}{\frac{1}{3}} 1\{t\in [-1,1]\}$


$\displaystyle = 3[\frac{1-t}{2} - \frac{(1-t)^2}{4}]1\{t\in [-1,1]\}$


$\displaystyle = \frac{3}{4}[\frac{1-t}{2} - \frac{(1-t)^2}{4}]1\{t\in [-1,1]\}$


$\displaystyle = \frac{3}{4}[1-t^2] 1\{t\in [-1,1]\}$

```{r, warning=FALSE, message=F}
library("ggplot2")
eq = function(x){(3/4)*(1-x^2)}
ggplot(data.frame(x=c(1, 50)), aes(x=x)) + 
  stat_function(fun=eq) + xlim(-1.5,1.5) + ylim(0,1)
```


## d)

$\beta = \displaystyle \int_{-\infty}^{\infty}\frac{\partial}{\partial t}(E[Y|X=t])w(t)dt$<br/>


$=\displaystyle \int_{-\infty}^{\infty}\frac{\partial}{\partial t}(t^3)w(t)dt$<br/>


$=\displaystyle 3 \int_{-\infty}^{\infty}t^2 (\frac{3}{4})[1-t^2]1\{t\in [-1,1]\} dt$<br/>


$=\displaystyle \frac{9}{4} \int_{-1}^{1}t^2-t^4 dt$<br/>


$=\displaystyle \frac{9}{4} ([\frac{t^3}{3}]^{1}_{-1} - [\frac{t^5}{5}]^{1}_{-1}) = \frac{9}{4} (\frac{2}{3}-\frac{2}{5}) = \frac{3}{5}$<br/>

## e)

$\displaystyle E[\frac{\partial}{\partial X}E[Y|X]] = E[3X^2] = 3E[X^2] = 3(\frac{1}{3} = 1)$<br/>


Since $1\ne\frac{3}{5}$, $\beta \ne E[\frac{\partial}{\partial X}E[Y|X]]$


# Problem 6

Loading data
```{r, warning=FALSE}
# Load the ak91.csv data
df <- read.csv("data/ak91.csv")
n <- nrow(df)

# Store years of education and the weekly wage in separate variables
yrs_educ <- df$YRS_EDUC
wkly_wage <- df$WKLY_WAGE
```


## a)

$\displaystyle \hat{\beta}_n = \frac{\frac{1}{n}\sum Y_i X_i - (\frac{1}{n}\sum Y_i) (\frac{1}{n}\sum X_i)}{\frac{1}{n}\sum X_i^2 - (\frac{1}{n}\sum X_i)^2}$


$\displaystyle \hat{\alpha}_n = \frac{1}{n}\sum Y_i-(\frac{1}{n}\sum X_i)\beta$



## b)

```{r, warning=FALSE, message=F}
beta <- (mean(wkly_wage*yrs_educ)-mean(wkly_wage)*mean(yrs_educ))/
  (mean(yrs_educ^2)-mean(yrs_educ)^2)

alpha <- mean(wkly_wage) - mean(yrs_educ)*beta
cat(paste0("beta: ",round(beta,2),"\nalpha: ",round(alpha,2)))
```


$\beta$ captures the approximate change in weekly change associated with a unit change in years of education i.e. another year of education. 


## c)

```{r, warning=FALSE, message=F}
alpha + 16*beta
```


The estimate here of $535.15 per week is lower than the solution in the previous pset. This is because in the previous pset, we took the sample of those with college education and calculated the estimator for weekly wage of those with a college education while here we use the entire sample to find the BLP coefficients relating weekly wage and years of education and use those to find an estimate for the weekly wage of those with college education. 


## d)

```{r, warning=FALSE, message=F}
res <- wkly_wage-(alpha+beta*yrs_educ)
num <- sqrt(mean((res^2)*((yrs_educ-mean(yrs_educ))^2)))
den <- sqrt(n)*var(yrs_educ)
se <- num/den
se
```

## e)

```{r, warning=FALSE, message=F}
Tn <- abs((beta-31)/se)
Tn
```

## f)

```{r, warning=FALSE, message=F}
pnorm(Tn,lower.tail = F)
```

## g)

Since p<0.01, we reject the null hypothesis. In words, this means that we can conclude that the change in weekly wage associated with an additional year of education is not $31. 

# Problem 7
## a)
```{r, warning=FALSE, message=F}
my_simplecoef <- function(y,x){
  beta <- cov(y,x)/var(x)
  alpha <- mean(y) - mean(x)*beta
  return(c(alpha,beta))
} 

coef <- my_simplecoef(wkly_wage,yrs_educ)
coef
```


## b)

```{r, warning=FALSE, message=F}
my_simpleblp <- function(coef,x){
  return(coef[1] + coef[2]*x)
}

mean(wkly_wage) - mean(mean(my_simpleblp(coef,yrs_educ)))
```


## c)

```{r, warning=FALSE, message=F}
my_simplese <- function(coef, y, x){
  eps <- y-(coef[1]+x*coef[2])
  num <- sqrt(mean((res^2)*((x-mean(x))^2)))
  den <- sqrt(length(x))*var(x)
  return(num/den)
}

se <- my_simplese(coef,wkly_wage,yrs_educ)
se
```

## d)

```{r, warning=FALSE, message=F}
my_simpleteststat <- function(beta,se){
  tn <- abs(beta/se)
  pval <- pnorm(tn,lower.tail = F)
  return(c(tn,pval))
}

my_simpleteststat(coef[2]-31,se)
```

## e)

```{r, warning=FALSE, message=F}
my_simpleols <- function(y,x){
  coef <- my_simplecoef(y,x)
  beta <- coef[2]
  se <- my_simplese(coef,y,x)
  teststat <- my_simpleteststat(beta-31,se)
  return(c(beta,se,teststat[1],teststat[2]))
}

my_simpleols(wkly_wage,yrs_educ)
```




